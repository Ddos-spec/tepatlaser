# .htaccess - Konfigurasi Optimal untuk Website Astro Statis

<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Selalu hapus 'www.' dari domain
  RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
  RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

  # Selalu paksa HTTPS
  RewriteCond %{HTTPS} off
  RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# ----------------------------------------------------------------------
# | Kinerja & Kompresi                                                 |
# ----------------------------------------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css application/xml application/xhtml+xml application/rss+xml application/javascript application/x-javascript application/json image/svg+xml
</IfModule>

# ----------------------------------------------------------------------
# | Cache Browser                                                      |
# ----------------------------------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault                          "access plus 1 month"
  
  # HTML
  ExpiresByType text/html                 "access plus 0 seconds"

  # Data
  ExpiresByType application/json          "access plus 0 seconds"
  ExpiresByType application/xml           "access plus 0 seconds"
  ExpiresByType text/xml                  "access plus 0 seconds"

  # Feed
  ExpiresByType application/atom+xml      "access plus 1 hour"
  ExpiresByType application/rss+xml       "access plus 1 hour"

  # Favicon
  ExpiresByType image/vnd.microsoft.icon  "access plus 1 week"
  ExpiresByType image/x-icon              "access plus 1 week"

  # Media: gambar, video, audio
  ExpiresByType image/gif                 "access plus 1 year"
  ExpiresByType image/jpeg                "access plus 1 year"
  ExpiresByType image/png                 "access plus 1 year"
  ExpiresByType image/svg+xml             "access plus 1 year"
  ExpiresByType image/webp                "access plus 1 year"
  
  # Font
  ExpiresByType font/woff                 "access plus 1 year"
  ExpiresByType font/woff2                "access plus 1 year"

  # CSS / JS
  ExpiresByType text/css                  "access plus 1 year"
  ExpiresByType application/javascript    "access plus 1 year"

  <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2)$">
    Header append Cache-Control "public, immutable"
  </FilesMatch>
</IfModule>

# ----------------------------------------------------------------------
# | Keamanan                                                           |
# ----------------------------------------------------------------------
<Files ~ "^\.(env|htaccess|htpasswd|git)">
    Order allow,deny
    Deny from all
    Satisfy all
</Files>
Options -Indexes

<IfModule mod_headers.c>
  Header always set X-Frame-Options "SAMEORIGIN"
  Header set X-Content-Type-Options "nosniff"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ----------------------------------------------------------------------
# | Routing untuk Astro (Handle 404)                                   |
# ----------------------------------------------------------------------
<IfModule mod_rewrite.c>
  # Arahkan semua request yang bukan file atau direktori ke halaman 404 Astro
  # Astro akan menanganinya dan menampilkan halaman 404 yang benar jika ada.
  # Jika tidak, ini akan fallback ke 404 default server.
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /404.html [L]
</IfModule>